<main class="container py-5">

    <section class="mb-5">
        <h2 class="h4 mb-4 text-gray-800 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                class="bi bi-book me-2 text-success" viewBox="0 0 16 16">
                <path
                    d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
            </svg>
            Current Books
        </h2>

        <div class="search-container">
            <input 
                type="text" 
                class="form-control search-input" 
                placeholder="Search by name, status..." 
                [(ngModel)]="searchText" />
            <button class="btn btn-search" (click)="loadUserLendingBooks(searchText)">Search</button>
        </div>


        <div class="row g-4">
            @for (item of userService.UserTransactionSignal(); track $index) {
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        @if (item.status ==1) {
                        <div class="fw-lighter">ID:{{item.lendID}} ({{item.requestDays}}) Days</div>
                        <h3 class="card-title h5 text-gray-800"><i class="bi bi-journal-check"></i> {{item.bookTitle}}
                        </h3>
                        <p class="card-text text-muted">{{item.authorName}}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            @if (item.dueDate == item.todayDateminus2) {
                            <span class="badge bg-success bg-opacity-10 text-warning">2 Days Left</span>
                            }
                            @else if (item.dueDate == item.todayDateminus1) {
                            <span class="badge bg-success bg-opacity-10 text-warning">1 Days Left</span>
                            }@else if (item.dueDate < item.actualDate) { <span
                                class="badge bg-success bg-opacity-10 text-danger">OverDue</span>
                                }
                                @else {
                                <span class="badge bg-success bg-opacity-10 text-success">Lending</span>
                                }
                                <small class="text-muted">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-calendar me-1 text-success" viewBox="0 0 16 16">
                                        <path
                                            d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                    </svg>
                                    lend: {{item.rentDate | date}}
                                </small>
                                <small class="text-muted">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-calendar me-1 text-success" viewBox="0 0 16 16">
                                        <path
                                            d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                    </svg>
                                    Due: {{item.dueDate | date}}
                                </small>
                        </div>
                        }
                        @else {
                        <div class="fw-lighter text-primary">ID:{{item.lendID}} ({{item.requestDays}}) Days</div>
                        <h3 class="card-title h5 text-primary"><i class="bi bi-journal-check"></i> {{item.bookTitle}}
                        </h3>
                        <p class="card-text text-primary">{{item.authorName}}</p>
                        <span class="badge bg-primary bg-opacity-10 text-primary">Requested</span>
                        <small class="text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-calendar me-1 text-success" viewBox="0 0 16 16">
                                <path
                                    d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                            </svg>
                            Request Date: {{item.requestDate | date:'yyyy-MM-dd'}}
                        </small>
                        }
                    </div>
                </div>
            </div>
            }
        </div>
    </section>
</main>